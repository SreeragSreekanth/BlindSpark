{% for r in page_obj %}
<div class="col-12 col-md-6 col-lg-4">
  <div class="card p-3 shadow-sm mb-3">
    <div class="text-center">
      {% if r.user.profile_photo %}
        <img src="{{ r.user.profile_photo.url }}" class="blur-photo" alt="{{ r.user.username }}">
      {% else %}
        <div style="width:160px;height:160px;border-radius:12px;background:#eee;"></div>
      {% endif %}
    </div>

    <div class="mt-3 text-center">
      <h5 class="mb-1">{{ r.user.username }}</h5>
      <p class="mb-1 text-muted">{{ r.user.city|default:"City not set" }}</p>
      <p class="fw-semibold mb-1">Match: {{ r.score }}%</p>
    </div>

    <div class="d-flex gap-2 mt-2">
      <a href="{% url 'matches:view_profile' r.user.id %}" class="btn btn-outline-primary w-50">View</a>
      <button type="button" class="btn btn-dark w-50 like-btn" data-id="{{ r.user.id }}">
        Like
      </button>
    </div>
  </div>
</div>
{% endfor %}

<script>
  document.querySelectorAll('.like-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.dataset.id;
      const url = "{% url 'matches:like_user' 0 %}".replace('0', id);  // â†’ /match/like/12/
  
      fetch(url, {
        method: 'POST',
        headers: {
          'X-CSRFToken': '{{ csrf_token }}',
          'X-Requested-With': 'XMLHttpRequest'
        }
      })
      .then(res => res.json())
      .then(data => {
        if (data.mutual) {
          btn.textContent = 'Mutual!';
          btn.classList.remove('btn-dark');
          btn.classList.add('btn-success');
          btn.disabled = true;
        } else if (data.liked) {
          btn.textContent = 'Liked!';
          btn.disabled = true;
        } else if (data.already_liked) {
          btn.textContent = 'Already Liked';
          btn.disabled = true;
        }
      })
      .catch(err => console.error('Like failed:', err));
    });
  });
  </script>

<style>
.blur-photo {
  width: 160px;
  height: 160px;
  object-fit: cover;
  border-radius: 12px;
  filter: blur(6px);
}

</style>
