{% extends 'base.html' %}
{% block content %}
<div class="container py-4" style="max-width:720px;">
  <div class="card p-4 shadow-sm">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-warning">{{ message }}</div>
      {% endfor %}
    {% endif %}
    <div class="text-center">
      {% if target.profile_photo %}
        <img src="{{ target.profile_photo.url }}" 
             class="profile-photo-blurred rounded-circle mb-3"
             style="width:180px;height:180px;object-fit:cover;"
             alt="{{ target.username }}">
      {% else %}
        <div style="width:180px;height:180px;border-radius:50%;background:#eee;margin:0 auto;"></div>
      {% endif %}
      <h3 class="mt-3">{{ target.username }}</h3>
      <p class="text-muted">{{ target.city|default:"City not set" }} â€¢ 
        {% if target.dob %}{{ target.age }} years{% else %}N/A{% endif %}</p>
      <p class="fw-semibold">Compatibility: {{ score }}%</p>
    </div>

    <hr>

    <h5>Bio</h5>
    <p>{{ target.bio|default:"No bio yet." }}</p>

    <h5>Interests</h5>
    <div class="d-flex flex-wrap gap-2 mb-3">
      {% for i in target.interests.all %}
        <span class="badge bg-secondary">{{ i.name }}</span>
      {% empty %}
        <em class="text-muted">None</em>
      {% endfor %}
    </div>

    {% if is_liked_by_me and is_liked_by_them %}
      <div class="alert alert-success text-center">
        Mutual Like! Chat Unlocked<br>
        <small>Matched on {{ match.matched_on|date:"M j, Y" }}</small>
      </div>
      <a href="#" class="btn btn-success w-100">Start Chat</a>
    {% elif is_liked_by_me %}
      <div class="alert alert-info">You liked them. Waiting for response...</div>
    {% else %}
      <form method="post" action="{% url 'matches:like_user' target.id %}">
        {% csrf_token %}
        <button class="btn btn-dark w-100 mb-2">Like</button>
      </form>
    {% endif %}

    <button onclick="history.back()" class="btn btn-outline-secondary w-100 mt-2">
      Back to Discover
    </button>
  </div>
</div>

<style>
.profile-photo-blurred {
  filter: blur(8px);
  border-radius: 50%;
  width: 180px;
  height: 180px;
  object-fit: cover;
  /* NO HOVER EFFECT */
}
</style>
{% endblock %}