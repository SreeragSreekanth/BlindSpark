{% load static %}

<div class="chat-messages">
  {% for m in messages %}

    {% ifchanged m.timestamp.date %}
      <div class="date-separator">
        <span>
          {% if m.timestamp.date == today %}
            Today
          {% elif m.timestamp.date == yesterday %}
            Yesterday
          {% else %}
            {{ m.timestamp|date:"M j, Y" }}
          {% endif %}
        </span>
      </div>
    {% endifchanged %}

    {% if m.is_deleted %}
      <div class="msg-row {% if m.sender == user %}right{% else %}left{% endif %}">
        <div class="msg-bubble deleted">
          <em>This message was deleted</em>
        </div>
      </div>

    {% else %}
      <div class="msg-row {% if m.sender == user %}right{% else %}left{% endif %}">
        <div class="msg-bubble {% if m.sender == user %}me{% else %}them{% endif %}"
             {% if m.sender == user %}data-msg-id="{{ m.id }}"{% endif %}>
          {{ m.text }}
          <div class="msg-time">{{ m.timestamp|date:"H:i" }}</div>
        </div>
      </div>
    {% endif %}

  {% endfor %}
</div>
